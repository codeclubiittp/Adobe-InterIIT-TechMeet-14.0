conda create --name textctrl python=3.8
conda activate textctrl
pip install --upgrade torch==2.0.1 torchvision==0.15.2 torchaudio==2.0.2 --index-url https://download.pytorch.org/whl/cu117
pip install -r requirement.txt
python api.py # to start the server

# Stop and remove old container
sudo docker stop textrewrite
sudo docker rm textrewrite

# Rebuild image
sudo docker build -t textrewrite-api .

# Run new container (-d : detached mode)
sudo docker run -p 8000:8000 --name textrewrite textrewrite-api

# Check logs
sudo docker logs -f textrewrite


### Install NVIDIA Container toolkit ###
Distributor ID: Ubuntu
Description: Ubuntu 24.04.3 LTS
Release: 24.04
Codename: noble

# Add the GPG key
curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg

# Add the generic deb repository
echo "deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://nvidia.github.io/libnvidia-container/stable/deb/$(dpkg --print-architecture) /" | sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list

# Install
sudo apt-get update
sudo apt-get install -y nvidia-container-toolkit

# Configure Docker and restart
sudo nvidia-ctk runtime configure --runtime=docker
sudo systemctl restart docker
# Test if Docker can access GPU
docker run --rm --gpus all nvidia/cuda:11.7.1-base-ubuntu20.04 nvidia-smi